test:
  suites:
  - name: Cloud AutoML Vision
    setup:
    - code: cloud_region = "us-central1"
      # Read Project ID from Environment Variable
    - env:
        name: GOOGLE_PROJECT_ID
        variable: project_id
    - env:
        name: AUTOML_TESTING_DATASET_NAME
        variable: dataset_name
    - call:
        sample: automl_vision_create_dataset
        params:
          project_id: { variable: project_id }
          location: { literal: "us-central1" }
          dataset_display_name: { variable: dataset_name }
    - extract_match:
        pattern: datasets/([^\s]+)
        variable: dataset_id
    - log: ["Matched dataset_id: %s", dataset_id]

    - assert_contains:
      - variable: dataset_name  
    teardown:
      # Read Project ID from Environment Variable
    - call: 
        sample: automl_vision_delete_dataset
        params:
          project_id: { variable: project_id }
          location: { literal: "us-central1" }
          dataset_id: { variable: dataset_id }
    - assert_contains:
      - literal: "Dataset deleted."

    cases:
    - name: List Datasets
      spec:
      - call: 
          sample: automl_vision_list_datasets
          params: 
            location: { literal: "us-central1" }
            project_id: { variable: project_id }
            filter: { literal: "imageClassificationDatasetMetadata:*" }
      - assert_contains:
        - literal: "Dataset name: "
        - variable: dataset_name
    - name: Get Dataset
      spec:
      - call: 
          sample: automl_vision_get_dataset
          params: 
            location: { literal: "us-central1" }
            project_id: { variable: project_id }
            dataset_id: { variable: dataset_id }
      - assert_contains:
        - literal: "Dataset name: " 
        - variable: dataset_name